<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Send information to the opportunity owner that All required &quot;Power of Attorney&quot; documents are now signed</description>
        <name>All_required_Power_of_Attorney_documents_are_now_signed</name>
        <label>All required &quot;Power of Attorney&quot; documents are now signed</label>
        <locationX>878</locationX>
        <locationY>1400</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>EmailText</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>$Record.Power_of_Attorney__r.Opportunity__r.Owner.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <stringValue>All required &quot;Power of Attorney&quot; documents are now signed</stringValue>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
    </actionCalls>
    <apiVersion>53.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>OppId</name>
        <label>OppId</label>
        <locationX>877</locationX>
        <locationY>1270</locationY>
        <assignmentItems>
            <assignToReference>varOppId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Power_of_Attorney__r.Opportunity__r.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>All_required_Power_of_Attorney_documents_are_now_signed</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Case_is_Related</name>
        <label>Case is Related</label>
        <locationX>411</locationX>
        <locationY>962</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesRelated</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Power_of_Attorney__r.Case__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Is_Case_with_Onboarded_Activation</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_Case_with_Onboarded_Activation</name>
        <label>Is Case with Onboarded Activation</label>
        <locationX>561</locationX>
        <locationY>961</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Power_of_Attorney__r.Case__r.AllActivationsReadyForQA__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>POAs</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_POA_signed</name>
        <label>Is POA signed?</label>
        <locationX>1091</locationX>
        <locationY>959</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesSigned</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Verify_POA_status.Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Signed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Verify_POA_status</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Pending_Status</name>
        <label>Pending Status</label>
        <locationX>134</locationX>
        <locationY>326</locationY>
        <defaultConnector>
            <targetReference>Sent_Status</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>False</defaultConnectorLabel>
        <rules>
            <name>TrueDraft</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.scrive__status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Draft</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.scrive__status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Withdrawn</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Power_of_Attorney__r.Status__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Signed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>POA_Pending</targetReference>
            </connector>
            <label>True</label>
        </rules>
    </decisions>
    <decisions>
        <name>Rejected_Status</name>
        <label>Rejected Status</label>
        <locationX>133</locationX>
        <locationY>806</locationY>
        <defaultConnector>
            <targetReference>Signed_Status</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>False</defaultConnectorLabel>
        <rules>
            <name>TrueRejected</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.scrive__status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Rejected</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Power_of_Attorney__r.Status__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Signed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>POA_Rejected</targetReference>
            </connector>
            <label>True</label>
        </rules>
    </decisions>
    <decisions>
        <name>Sent_Status</name>
        <label>Sent Status</label>
        <locationX>133</locationX>
        <locationY>487</locationY>
        <defaultConnector>
            <targetReference>Timedout</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>False</defaultConnectorLabel>
        <rules>
            <name>TrueSent</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.scrive__status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Sent</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Power_of_Attorney__r.Status__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Signed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>POA_Waiting</targetReference>
            </connector>
            <label>True</label>
        </rules>
    </decisions>
    <decisions>
        <name>Signed_Status</name>
        <label>Signed Status</label>
        <locationX>133</locationX>
        <locationY>963</locationY>
        <defaultConnectorLabel>False</defaultConnectorLabel>
        <rules>
            <name>TrueSigned</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.scrive__status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Signed</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Power_of_Attorney__r.Status__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Signed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>POA_Signed</targetReference>
            </connector>
            <label>True</label>
        </rules>
    </decisions>
    <decisions>
        <name>Timedout</name>
        <label>Timedout</label>
        <locationX>133</locationX>
        <locationY>645</locationY>
        <defaultConnector>
            <targetReference>Rejected_Status</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>False</defaultConnectorLabel>
        <rules>
            <name>TrueTimedout</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.scrive__status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Timedout</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Power_of_Attorney__r.Status__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Signed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>POA_Timedout</targetReference>
            </connector>
            <label>True</label>
        </rules>
    </decisions>
    <description>Updates POA Status based on Scrive document status. Updates the POA status field (Power_of_Attorney__c) on Case if Scrive document was signed after the onboarding process is completed and notifies the opportunity owner.</description>
    <environments>Default</environments>
    <formulas>
        <name>OppLink</name>
        <dataType>String</dataType>
        <expression>LEFT({!$Api.Enterprise_Server_URL_510}, FIND( &apos;/services&apos;, {!$Api.Enterprise_Server_URL_510})) &amp; 
{!varOppId}</expression>
    </formulas>
    <interviewLabel>POA Status Update from Scrive Document Status {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Scrive Document Status Change triggers POA Status Update</label>
    <loops>
        <name>Verify_POA_status</name>
        <label>Verify POA status</label>
        <locationX>876</locationX>
        <locationY>959</locationY>
        <collectionReference>POAs</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Is_POA_signed</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_Case</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>POAs</name>
        <label>POAs</label>
        <locationX>727</locationX>
        <locationY>959</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Verify_POA_status</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Case__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Power_of_Attorney__r.Case__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Porting__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>POA_Pending</name>
        <label>POA Pending</label>
        <locationX>287</locationX>
        <locationY>325</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Power_of_Attorney__r.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Pending</stringValue>
            </value>
        </inputAssignments>
        <object>Porting__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>POA_Rejected</name>
        <label>POA Rejected</label>
        <locationX>292</locationX>
        <locationY>803</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Power_of_Attorney__r.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Rejected</stringValue>
            </value>
        </inputAssignments>
        <object>Porting__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>POA_Signed</name>
        <label>POA Signed</label>
        <locationX>294</locationX>
        <locationY>960</locationY>
        <connector>
            <targetReference>Case_is_Related</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Power_of_Attorney__r.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Signed</stringValue>
            </value>
        </inputAssignments>
        <object>Porting__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>POA_Timedout</name>
        <label>POA Timedout</label>
        <locationX>287</locationX>
        <locationY>644</locationY>
        <filterLogic>1 AND (2 OR 3)</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Power_of_Attorney__r.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Signed</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Rejected</stringValue>
            </value>
        </filters>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Timedout</stringValue>
            </value>
        </inputAssignments>
        <object>Porting__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>POA_Waiting</name>
        <label>POA Waiting for Signature</label>
        <locationX>289</locationX>
        <locationY>485</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Power_of_Attorney__r.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Waiting for Signature</stringValue>
            </value>
        </inputAssignments>
        <object>Porting__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Case</name>
        <label>Update Case</label>
        <locationX>877</locationX>
        <locationY>1123</locationY>
        <connector>
            <targetReference>OppId</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Power_of_Attorney__r.Case__r.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Power_of_attorney__c</field>
            <value>
                <stringValue>Received and attached to case</stringValue>
            </value>
        </inputAssignments>
        <object>Case</object>
    </recordUpdates>
    <start>
        <locationX>16</locationX>
        <locationY>12</locationY>
        <connector>
            <targetReference>Pending_Status</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>scrive__status__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Power_of_Attorney__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <object>scrive__ScriveDocument__c</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>EmailText</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>This is a notification that all required &quot;Power of Attorney&quot; documents related to the Opportunity you own have been signed. 
Link to the Opportunity: {!OppLink}</text>
    </textTemplates>
    <variables>
        <name>varOppId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
