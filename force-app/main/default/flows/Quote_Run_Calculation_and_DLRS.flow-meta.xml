<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>57.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <decisions>
        <name>Was_any_Incomplete_QuoteLine_found</name>
        <label>Was any Incomplete QuoteLine found</label>
        <locationX>182</locationX>
        <locationY>408</locationY>
        <defaultConnectorLabel>No Incomplete QuoteLine</defaultConnectorLabel>
        <rules>
            <name>Incomplete_QuoteLine_Found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Incomplete_QuoteLine</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_QuoteLine</targetReference>
            </connector>
            <label>Incomplete QuoteLine Found</label>
        </rules>
    </decisions>
    <description>When Ready for Calculation is set to true on Quote this flow will be executed. The flow will check if any of the related Quote Lines is incomplete, and if so change just one line to complete (this will start the Quote calculation). After Calculation DLRS will run and Ready for Calculation will be set to false.</description>
    <environments>Default</environments>
    <formulas>
        <name>TenSeconds</name>
        <dataType>Number</dataType>
        <expression>10/24*60*60</expression>
        <scale>8</scale>
    </formulas>
    <interviewLabel>Quote Run Calculation and DLRS {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Quote Run Calculation and DLRS</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Incomplete_QuoteLine</name>
        <label>Get Incomplete QuoteLine</label>
        <locationX>182</locationX>
        <locationY>288</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Was_any_Incomplete_QuoteLine_found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>SBQQ__Quote__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>SBQQ__Incomplete__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>SBQQ__QuoteLine__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <description>Update Incomplete on QuoteLine to start Quote Calculation</description>
        <name>Update_QuoteLine</name>
        <label>Update QuoteLine</label>
        <locationX>50</locationX>
        <locationY>528</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Incomplete_QuoteLine.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>SBQQ__Incomplete__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <object>SBQQ__QuoteLine__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Ready_For_Calculation_on_Quote</name>
        <label>Update Ready For Calculation on Quote</label>
        <locationX>490</locationX>
        <locationY>408</locationY>
        <inputAssignments>
            <field>Ready_for_Calculation__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>210</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Incomplete_QuoteLine</targetReference>
        </connector>
        <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Ready_for_Calculation__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>SBQQ__Quote__c</object>
        <recordTriggerType>Update</recordTriggerType>
        <scheduledPaths>
            <name>Run_DLRS_Calculation</name>
            <connector>
                <targetReference>Run_Quote_Line_DLRS</targetReference>
            </connector>
            <label>Run DLRS Calculation</label>
            <offsetNumber>0</offsetNumber>
            <offsetUnit>Minutes</offsetUnit>
            <timeSource>RecordTriggerEvent</timeSource>
        </scheduledPaths>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <name>Run_Quote_Line_DLRS</name>
        <label>Run Quote Line DLRS</label>
        <locationX>490</locationX>
        <locationY>288</locationY>
        <connector>
            <targetReference>Update_Ready_For_Calculation_on_Quote</targetReference>
        </connector>
        <flowName>Quote_Line_DLRS</flowName>
        <inputAssignments>
            <name>QuoteID</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
</Flow>
