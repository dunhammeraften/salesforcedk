<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Notification_Fokus_error</name>
        <label>Notification Fokus error</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <actionName>customNotificationAction</actionName>
        <actionType>customNotificationAction</actionType>
        <connector>
            <targetReference>Update_Error_Message_Fokus</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>customNotifTypeId</name>
            <value>
                <elementReference>Get_Notification_type.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientIds</name>
            <value>
                <elementReference>caseOwner</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>Activation Line - Fokus error</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>notificationBodyFokusError</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>targetId</name>
            <value>
                <elementReference>$Record.Activation__r.Case__r.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>customNotificationAction</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>Notification_No_Number</name>
        <label>Notification no Number</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <actionName>customNotificationAction</actionName>
        <actionType>customNotificationAction</actionType>
        <connector>
            <targetReference>Update_Error_Message_No_Number</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>customNotifTypeId</name>
            <value>
                <elementReference>Get_Notification_type.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientIds</name>
            <value>
                <elementReference>caseOwner</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>Activation Line - selected number not assigned to the Account</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>notificationBodyNoNumber</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>targetId</name>
            <value>
                <elementReference>$Record.Activation__r.Case__r.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>customNotificationAction</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>Notification_Not_Enough_Numbers</name>
        <label>Notification Not Enough Numbers</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <actionName>customNotificationAction</actionName>
        <actionType>customNotificationAction</actionType>
        <connector>
            <targetReference>Update_Error_Message_Not_Enough_Numbers</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>customNotifTypeId</name>
            <value>
                <elementReference>Get_Notification_type.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientIds</name>
            <value>
                <elementReference>caseOwner</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>Activation Line - not enough numbers</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>notificationBodyNotEnoughNumbers</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>targetId</name>
            <value>
                <elementReference>$Record.Activation__r.Case__r.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>customNotificationAction</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>Notification_Remote_Number_does_not_exist</name>
        <label>Notification Remote Number does not exist</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <actionName>customNotificationAction</actionName>
        <actionType>customNotificationAction</actionType>
        <connector>
            <targetReference>Update_Error_Message_Remote_Number_does_not_exist</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>customNotifTypeId</name>
            <value>
                <elementReference>Get_Notification_type.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientIds</name>
            <value>
                <elementReference>caseOwner</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>The existing number does not exist in Fokus</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>notificationBodyTransactionError</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>targetId</name>
            <value>
                <elementReference>$Record.Case__r.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>customNotificationAction</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>Notification_Transaction_error</name>
        <label>Notification Transaction error</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <actionName>customNotificationAction</actionName>
        <actionType>customNotificationAction</actionType>
        <connector>
            <targetReference>Update_Error_Message_Transaction</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>customNotifTypeId</name>
            <value>
                <elementReference>Get_Notification_type.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientIds</name>
            <value>
                <elementReference>caseOwner</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>Activation Line - transaction Error</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>notificationBodyTransactionError</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>targetId</name>
            <value>
                <elementReference>$Record.Activation__r.Case__r.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>customNotificationAction</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>Notification_Unexpected_exception</name>
        <label>Notification Unexpected exception</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <actionName>customNotificationAction</actionName>
        <actionType>customNotificationAction</actionType>
        <connector>
            <targetReference>Update_Error_Message_Exception</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>customNotifTypeId</name>
            <value>
                <elementReference>Get_Notification_type.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientIds</name>
            <value>
                <elementReference>caseOwner</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>Activation Line - unexpected exception</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>notificationBodyException</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>targetId</name>
            <value>
                <elementReference>$Record.Activation__r.Case__r.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>customNotificationAction</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <apiVersion>64.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Assign_User_to_variable</name>
        <label>Assign User to variable</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>caseOwner</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>$Record.Activation__r.Case__r.OwnerId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Type_of_Error</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Type_of_Error</name>
        <label>Type of Error</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>Clear_Case_Warning</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Number_does_not_exist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Phone_Number_Reservation_Error__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>[NCEA001]</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notification_No_Number</targetReference>
            </connector>
            <label>Number does not exist</label>
        </rules>
        <rules>
            <name>Fokus_Error</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Phone_Number_Reservation_Error__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>[NCEH001]</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notification_Fokus_error</targetReference>
            </connector>
            <label>Fokus Error</label>
        </rules>
        <rules>
            <name>Unexpected_exception</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Phone_Number_Reservation_Error__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>[NCEH002]</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notification_Unexpected_exception</targetReference>
            </connector>
            <label>Unexpected exception</label>
        </rules>
        <rules>
            <name>Transaction_error</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Phone_Number_Reservation_Error__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>[NCEH003] </stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Phone_Number_Reservation_Error__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>[NSS001] </stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notification_Transaction_error</targetReference>
            </connector>
            <label>Transaction error</label>
        </rules>
        <rules>
            <name>Not_enough_numbers</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Phone_Number_Reservation_Error__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>[NCEH004]</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notification_Not_Enough_Numbers</targetReference>
            </connector>
            <label>Not enough numbers</label>
        </rules>
        <rules>
            <name>Number_does_not_exist_in_remote</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Phone_Number_Reservation_Error__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>[NSS001] </stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notification_Remote_Number_does_not_exist</targetReference>
            </connector>
            <label>Number does not exist in remote</label>
        </rules>
    </decisions>
    <description>Sends a Notification to the Case Owner when the Phone Number Reservation Error field on Activation Line is populated.</description>
    <environments>Default</environments>
    <formulas>
        <name>notificationBodyException</name>
        <dataType>String</dataType>
        <expression>&quot;The Activation Line: &quot; + {!$Record.Name} + &quot; related to Case &quot; + {!$Record.Case__r.CaseNumber} + &quot; experiences an unexpected exception error . Please move the Activation to Reserve Numbers again. If the error persists please contact the Salesforce team&quot;</expression>
    </formulas>
    <formulas>
        <name>notificationBodyFokusError</name>
        <dataType>String</dataType>
        <expression>&quot;The Activation Line: &quot; + {!$Record.Name} + &quot; related to Case &quot; + {!$Record.Case__r.CaseNumber} + &quot; has an error related to Fokus. Please move the Activation to Reserve Numbers again. If the error persists please contact the Salesforce team&quot;</expression>
    </formulas>
    <formulas>
        <name>notificationBodyNoNumber</name>
        <dataType>String</dataType>
        <expression>&quot;The Activation Line: &quot; + {!$Record.Name} + &quot; related to Case &quot; + {!$Record.Case__r.CaseNumber} + &quot; has been assigned a number that is not allocated to the Account. Please add another number and move the Activation to Reserve Numbers again&quot;</expression>
    </formulas>
    <formulas>
        <name>notificationBodyNotEnoughNumbers</name>
        <dataType>String</dataType>
        <expression>&quot;The Account &quot; + {!$Record.Case__r.Account.Name} + &quot; related to Activation &quot; + {!$Record.Activation__r.Name} + &quot; does not have enough Phone Numbers to be assigned to the Activation Lines. Please reserve more numbers for the open Account Phone Number Series. When you have enough numbers, please set the Activation progress to Reserve Numbers again&quot;</expression>
    </formulas>
    <formulas>
        <name>notificationBodyTransactionError</name>
        <dataType>String</dataType>
        <expression>&quot;The Activation Line: &quot; + {!$Record.Name} + &quot; related to Case &quot; + {!$Record.Case__r.CaseNumber} + &quot; experiences a transaction error. Please contact the Salesforce team for assistance&quot;</expression>
    </formulas>
    <interviewLabel>Phone Number {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Phone Number - Activation Line Error Notifications</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Notification_type</name>
        <label>Get Notification type</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assign_User_to_variable</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Activation_Line_Notification</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>CustomNotificationType</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Clear_Case_Warning</name>
        <label>Clear Case Warning</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Clear_Error_Field</targetReference>
        </connector>
        <inputAssignments>
            <field>Activation_Line_Warning_Trigger__c</field>
            <value>
                <stringValue>Green</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record.Case__r</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Clear_Error_Field</name>
        <label>Clear Error Field</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <inputAssignments>
            <field>Activation_Line_Error_Code__c</field>
            <value>
                <stringValue></stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Set_Case_Warning</name>
        <label>Set Case Warning</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <inputAssignments>
            <field>Activation_Line_Warning_Trigger__c</field>
            <value>
                <stringValue>Red</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record.Case__r</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Error_Message_Exception</name>
        <label>Update Error Message Exception</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Set_Case_Warning</targetReference>
        </connector>
        <inputAssignments>
            <field>Activation_Line_Error_Code__c</field>
            <value>
                <stringValue>NCEH002</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Error_Message_Fokus</name>
        <label>Update Error Message Fokus</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Set_Case_Warning</targetReference>
        </connector>
        <inputAssignments>
            <field>Activation_Line_Error_Code__c</field>
            <value>
                <stringValue>NCEH001</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Error_Message_No_Number</name>
        <label>Update Error Message No Number</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Set_Case_Warning</targetReference>
        </connector>
        <inputAssignments>
            <field>Activation_Line_Error_Code__c</field>
            <value>
                <stringValue>NCEA001</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Error_Message_Not_Enough_Numbers</name>
        <label>Update Error Message Not Enough Numbers</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Set_Case_Warning</targetReference>
        </connector>
        <inputAssignments>
            <field>Activation_Line_Error_Code__c</field>
            <value>
                <stringValue>NCEH004</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Error_Message_Remote_Number_does_not_exist</name>
        <label>Update Error Message Remote Number does not exist</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Set_Case_Warning</targetReference>
        </connector>
        <inputAssignments>
            <field>Activation_Line_Error_Code__c</field>
            <value>
                <stringValue>NSS001</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Error_Message_Transaction</name>
        <label>Update Error Message Transaction</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Set_Case_Warning</targetReference>
        </connector>
        <inputAssignments>
            <field>Activation_Line_Error_Code__c</field>
            <value>
                <stringValue>NCEH003</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Notification_type</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Phone_Number_Reservation_Error__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>Activation_line__c</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <name>caseOwner</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
