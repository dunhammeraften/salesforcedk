<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>52.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <description>Then we add the monthly recurring revenue data to the collection of Revenue Forecast Items we want to create.</description>
        <name>Add_Record_to_Collection</name>
        <label>Add Record to Collection</label>
        <locationX>590</locationX>
        <locationY>510</locationY>
        <assignmentItems>
            <assignToReference>varForecastItemsToCreate</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varRevenueForecastToCreate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Everything_Processed</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Here we add the data to the collection of Revenue Forecast Items that we want to create later.</description>
        <name>Add_to_Collection</name>
        <label>Add OTC to Collection</label>
        <locationX>54</locationX>
        <locationY>837</locationY>
        <assignmentItems>
            <assignToReference>varForecastItemsToCreate</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varRevenueForecastToCreate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Values</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Here we set new values for the next record that we want to create. These will overwrite the variables that we potentially already used in the One Time Charges or previous steps.</description>
        <name>Assign_Values</name>
        <label>Assign Values</label>
        <locationX>363</locationX>
        <locationY>688</locationY>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inpOpportunityId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.Forecast_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>MonthTracker</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.Forecasted_Amount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inpForecastedAmunt</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inpOwnerId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Recurring</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.Quote__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inpQuoteId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.Cross_Selling_and_Upselling_Amount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inpCrossUpsaleAmount</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Increase_Counter</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>This sets the data for the one-time charge record we want to create.</description>
        <name>Create_One_Time_Charges</name>
        <label>Create One Time Charges</label>
        <locationX>55</locationX>
        <locationY>659</locationY>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inpOpportunityId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.Forecast_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>MonthTracker</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.Forecasted_Amount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inpOneTimeCharges</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inpOwnerId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>One Time Charge</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRevenueForecastToCreate.Quote__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inpQuoteId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_to_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>We add 1 to the counter so that the months can be calculated by the formula and the flow will know when to stop by comparing it to the subscription term.</description>
        <name>Increase_Counter</name>
        <label>Increase Counter</label>
        <locationX>590</locationX>
        <locationY>688</locationY>
        <assignmentItems>
            <assignToReference>varNumberCounter</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_Record_to_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>This sets the NumberCounter to zero. We will use the number of months passed to calculate and set the dates on the records when creating the forecast items for each month.</description>
        <name>Initialize_Loop_Counter</name>
        <label>Initialize Loop Counter</label>
        <locationX>469</locationX>
        <locationY>196</locationY>
        <assignmentItems>
            <assignToReference>varNumberCounter</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Everything_Processed</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>This first sends the flow to create the initial one-time charges and then the recurring revenue for the same month. It then compares the NumberCounter to the Subscription term (in months) to determine if it still needs to create another one. When the NumberCounter equals Subscription term, it&apos;s time to create the records.</description>
        <name>Everything_Processed</name>
        <label>Everything Processed</label>
        <locationX>462</locationX>
        <locationY>398</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>First_Item</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varNumberCounter</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>One_Time_Charges</targetReference>
            </connector>
            <label>First Item</label>
        </rules>
        <rules>
            <name>Not_yet</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varNumberCounter</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>inpSubscriptionTerm</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Values</targetReference>
            </connector>
            <label>Not yet</label>
        </rules>
        <rules>
            <name>Yes_create_records</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varNumberCounter</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>inpSubscriptionTerm</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Forecast_Items</targetReference>
            </connector>
            <label>Yes, create records</label>
        </rules>
    </decisions>
    <decisions>
        <description>This checks if there are any one-time charges to be added. If so, it will create them and if not, it will skip to creating the recurring revenue for the first month.</description>
        <name>One_Time_Charges</name>
        <label>One Time Charges?</label>
        <locationX>50</locationX>
        <locationY>476</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>inpOneTimeCharges</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_One_Time_Charges</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
        <rules>
            <name>No</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>inpOneTimeCharges</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Values</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <formulas>
        <name>CrossSellMonthly</name>
        <dataType>Currency</dataType>
        <expression>{!inpCrossUpsaleAmount}/{!inpSubscriptionTerm}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>MonthTracker</name>
        <dataType>Date</dataType>
        <expression>DATE(YEAR(ADDMONTHS({!inpStartDate},{!varNumberCounter})),
MONTH(ADDMONTHS({!inpStartDate},{!varNumberCounter})),1)</expression>
    </formulas>
    <interviewLabel>Revenue Forecast generator subflow {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Revenue Forecast generator subflow</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <description>And perhaps unsurprisingly this then actually creates the Revenue Forecast records</description>
        <name>Create_Forecast_Items</name>
        <label>Create Forecast Items</label>
        <locationX>903</locationX>
        <locationY>562</locationY>
        <inputReference>varForecastItemsToCreate</inputReference>
    </recordCreates>
    <start>
        <locationX>343</locationX>
        <locationY>50</locationY>
        <connector>
            <targetReference>Initialize_Loop_Counter</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>inpCrossUpsaleAmount</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>inpForecastedAmunt</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>inpOneTimeCharges</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>inpOpportunityId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>inpOwnerId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>inpQuoteId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>inpStartDate</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>inpSubscriptionTerm</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>varForecastItemsToCreate</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Revenue_Forecast__c</objectType>
    </variables>
    <variables>
        <name>varNumberCounter</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>varRevenueForecastToCreate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Revenue_Forecast__c</objectType>
    </variables>
</Flow>
