public with sharing class ActivationLineExportController {
    
    @AuraEnabled(cacheable=true)
    public static List<Activation_line__c> getActivationLines(String caseId) {

        set<String> productCodes = getProductCodes();
        
        return [
            SELECT 
            Product__c,
            Quote_line__c,
            Phone_no__c,
            First_name__c,
            Last_name__c,
            Phone_no_Status__c,
            Mobile_no__c,
            Telia_INSIGHT_e_mail_contact__c,
            SIM_number__c,
            Not_to_Activation__c,
            Operator__c,
            Sales_type__c,
            Power_of_Attorney_record__c,
            Planned_delivery_date__c,
            Number_Porting_Specific_Date__c,
            Modified_delivery_date__c,
            Number_Porting_End_of_Commitment__c,
            Existing_SIM_number__c,
            Related_Activation_line__c,
            Telia_til_Telia_transfer__c,
            UC_Invoicing__c,
            Number_Series_Main_Number__c,
            Show_On_Onboarding_Page__c,
            Onboarding_Activation_Line__c,
            Escalated__c,
            VAS_CORDKTEU4__c,
            VAS_SIMBTB11__c,
            VAS_CORDKTEU5__c,
            Ekstra_Data_SIM_number__c,
            VAS_CORDKTOEU__c,
            VAS_SIMBX5__c,
            VAS_CORWA10G__c,
            Ekstra_Data_SIM_number_2__c,
            VAS_CORWA5G__c,
            VAS_SIMBX6__c,
            VAS_CORWB8G__c,
            Ekstra_Data_SIM_number_3__c,
            VAS_CORWA9G__c,
            VAS_SIMBX7__c,
            VAS_CORUSA5G__c,
            Ekstra_Data_SIM_number_4__c,
            VAS_CORAS5G__c,
            VAS_DUMMY2__c,
            VAS_ALLBIZA__c,
            VAS_TMSBBAND__c,
            VAS_FIX2MOBIL__c,
            VAS_TMSMOBILE__c,
            VAS_EntitleAW__c,
            VAS_M2MROAM__c,
            VAS_M2M_Data__c,
            VAS_M2M_SMS__c,
            Funktionsnr__c,
            Touchpoint_Statistik__c,
            Touchpoint_Bruger__c,
            Touchpoint_Softphone__c,
            Touchpoint_Receptionist__c,
            VAS_UC_License__c,
            Email__c,
            Shortnr__c,
            Department__c,
            Administrator__c,
            Job_description__c,
            Supervisor__c,
            Locale__c,
            Attendant_Agent_login__c,
            Keywords__c,
            VAS_TPXRECB__c,
            VAS_TPXREC3__c,
            VAS_TPXREC7__c,
            Fastnet_no_Type__c,
            Wallboard__c,
            Fax__c,
            Conference__c,
            Extra_ACD_k__c,
            Statistics__c,
            Extra_ACD_k_Quantity__c,
            Single_No__c,
            Supervisor_No__c,
            X70_80_nummer__c,
            Attendant_Agent_login_No__c,
            TPX_Deskphone__c,
            TPX_Power_Adapter__c,
            VAS_OCMUSR__c,
            VAS_FINTDKEU__c,
            VAS_OCCATTCON__c,
            VAS_OCCONB__c,
            VAS_OCCOFFCLI__c,
            VAS_OCCAAO__c,
            VAS_OCCCCENTV__c,
            VAS_OCCAAS__c,
            VAS_OCCCCWGRV__c,
            VAS_OCCAAU__c,
            VAS_OCCMOBPGW__c,
            VAS_OCCBAS__c,
            VAS_OCCIVREXP__c,
            VAS_OCCASO__c,
            VAS_OCCCLBACK__c,
            VAS_OCCCON__c,
            VAS_OCCQUAMON__c,
            VAS_OCCINS__c,
            VAS_OCCCCENTM__c,
            VAS_OCCCCWGRM__c,
            VAS_OCCCRMINT__c,
            VAS_OCCMAILDI__c,
            VAS_OCCAVAIVA__c,
            VAS_OCCSCSTAT__c,
            VAS_OCCAGRECO__c,
            VAS_BAR3G__c,
            VAS_BARPRCSMS__c,
            VAS_BAR4G__c,
            VAS_BAR90__c,
            VAS_BARDATA__c,
            VAS_BARORXD__c,
            VAS_BARINTRO__c,
            VAS_BAROUTRO__c,
            VAS_BARMMS__c,
            VAS_BARINTCAL__c,
            VAS_BARTOTRO__c,
            VAS_BARSTD__c,
            VAS_BARLEVEL__c,
            Forbrugskontrol_amount__c,
            VAS_BARINC__c,
            VAS_BARTOTAL__c,
            VAS_BAROUTG__c,
            RCC_Owner_Control__c,
            VAS_BARINCRO__c,
            TSRR_Owner_Control__c,
            NUA_Owner_Control__c,
            VAS_TSPBRONZE__c,
            VAS_TSPSOLV__c,
            VAS_TSPGULD__c,
            Billing_Account__c,
            Billing_Account_Number__c,
            Invoice_Type_F__c,
            Invoice_Email_F__c,
            Company_Name__c,
            EAN_number_F__c,
            Delivery_Att__c,
            Billing_Att_F__c,
            Delivery_Street_and_number__c,
            Billing_Name_F__c,
            Delivery_City__c,
            Billing_Street_and_No_F__c,
            Postal_Code__c,
            Billing_Postal_Code_F__c,
            Delivery_Country__c,
            Billing_City_F__c,
            Delivery_Email__c,
            Billing_Country_F__c
            FROM Activation_line__c
            WHERE Case__c = :caseId AND Product_Code_1__c IN :productCodes
        ];
    }
    @AuraEnabled(cacheable=true)
    public static List<Activation_line__c> getActivationLinesAllProducts(String caseId) {
         
        return [
            SELECT 
            Product__c,
            Quote_line__c,
            Phone_no__c,
            First_name__c,
            Last_name__c,
            Phone_no_Status__c,
            Mobile_no__c,
            Telia_INSIGHT_e_mail_contact__c,
            SIM_number__c,
            Not_to_Activation__c,
            Operator__c,
            Sales_type__c,
            Power_of_Attorney_record__c,
            Planned_delivery_date__c,
            Number_Porting_Specific_Date__c,
            Modified_delivery_date__c,
            Number_Porting_End_of_Commitment__c,
            Existing_SIM_number__c,
            Related_Activation_line__c,
            Telia_til_Telia_transfer__c,
            UC_Invoicing__c,
            Number_Series_Main_Number__c,
            Show_On_Onboarding_Page__c,
            Onboarding_Activation_Line__c,
            Escalated__c,
            VAS_CORDKTEU4__c,
            VAS_SIMBTB11__c,
            VAS_CORDKTEU5__c,
            Ekstra_Data_SIM_number__c,
            VAS_CORDKTOEU__c,
            VAS_SIMBX5__c,
            VAS_CORWA10G__c,
            Ekstra_Data_SIM_number_2__c,
            VAS_CORWA5G__c,
            VAS_SIMBX6__c,
            VAS_CORWB8G__c,
            Ekstra_Data_SIM_number_3__c,
            VAS_CORWA9G__c,
            VAS_SIMBX7__c,
            VAS_CORUSA5G__c,
            Ekstra_Data_SIM_number_4__c,
            VAS_CORAS5G__c,
            VAS_DUMMY2__c,
            VAS_ALLBIZA__c,
            VAS_TMSBBAND__c,
            VAS_FIX2MOBIL__c,
            VAS_TMSMOBILE__c,
            VAS_EntitleAW__c,
            VAS_M2MROAM__c,
            VAS_M2M_Data__c,
            VAS_M2M_SMS__c,
            Funktionsnr__c,
            Touchpoint_Statistik__c,
            Touchpoint_Bruger__c,
            Touchpoint_Softphone__c,
            Touchpoint_Receptionist__c,
            VAS_UC_License__c,
            Email__c,
            Shortnr__c,
            Department__c,
            Administrator__c,
            Job_description__c,
            Supervisor__c,
            Locale__c,
            Attendant_Agent_login__c,
            Keywords__c,
            VAS_TPXRECB__c,
            VAS_TPXREC3__c,
            VAS_TPXREC7__c,
            Fastnet_no_Type__c,
            Wallboard__c,
            Fax__c,
            Conference__c,
            Extra_ACD_k__c,
            Statistics__c,
            Extra_ACD_k_Quantity__c,
            Single_No__c,
            Supervisor_No__c,
            X70_80_nummer__c,
            Attendant_Agent_login_No__c,
            TPX_Deskphone__c,
            TPX_Power_Adapter__c,
            VAS_OCMUSR__c,
            VAS_FINTDKEU__c,
            VAS_OCCATTCON__c,
            VAS_OCCONB__c,
            VAS_OCCOFFCLI__c,
            VAS_OCCAAO__c,
            VAS_OCCCCENTV__c,
            VAS_OCCAAS__c,
            VAS_OCCCCWGRV__c,
            VAS_OCCAAU__c,
            VAS_OCCMOBPGW__c,
            VAS_OCCBAS__c,
            VAS_OCCIVREXP__c,
            VAS_OCCASO__c,
            VAS_OCCCLBACK__c,
            VAS_OCCCON__c,
            VAS_OCCQUAMON__c,
            VAS_OCCINS__c,
            VAS_OCCCCENTM__c,
            VAS_OCCCCWGRM__c,
            VAS_OCCCRMINT__c,
            VAS_OCCMAILDI__c,
            VAS_OCCAVAIVA__c,
            VAS_OCCSCSTAT__c,
            VAS_OCCAGRECO__c,
            VAS_BAR3G__c,
            VAS_BARPRCSMS__c,
            VAS_BAR4G__c,
            VAS_BAR90__c,
            VAS_BARDATA__c,
            VAS_BARORXD__c,
            VAS_BARINTRO__c,
            VAS_BAROUTRO__c,
            VAS_BARMMS__c,
            VAS_BARINTCAL__c,
            VAS_BARTOTRO__c,
            VAS_BARSTD__c,
            VAS_BARLEVEL__c,
            Forbrugskontrol_amount__c,
            VAS_BARINC__c,
            VAS_BARTOTAL__c,
            VAS_BAROUTG__c,
            RCC_Owner_Control__c,
            VAS_BARINCRO__c,
            TSRR_Owner_Control__c,
            NUA_Owner_Control__c,
            VAS_TSPBRONZE__c,
            VAS_TSPSOLV__c,
            VAS_TSPGULD__c,
            Billing_Account__c,
            Billing_Account_Number__c,
            Invoice_Type_F__c,
            Invoice_Email_F__c,
            Company_Name__c,
            EAN_number_F__c,
            Delivery_Att__c,
            Billing_Att_F__c,
            Delivery_Street_and_number__c,
            Billing_Name_F__c,
            Delivery_City__c,
            Billing_Street_and_No_F__c,
            Postal_Code__c,
            Billing_Postal_Code_F__c,
            Delivery_Country__c,
            Billing_City_F__c,
            Delivery_Email__c,
            Billing_Country_F__c
            FROM Activation_line__c
            WHERE Case__c = :caseId
        ];
    }
    
    @TestVisible
	private static set<String> getProductCodes(){
        List<VTPX_User_Datatable_Products__mdt> configs = MetadataSelector.getVTPXUserDatatableProducts();
        
        set<String> productCodes = new Set<String>();
        for (VTPX_User_Datatable_Products__mdt config : configs) {
            if (!config.Hide__c) {
                productCodes.add(config.Product_Code__c);
            }
        }
        
        return productCodes;
    }
}